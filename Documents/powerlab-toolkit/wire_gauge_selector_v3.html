<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wire Gauge Selector</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 720px; margin: 2rem auto; padding: 0 1rem; background: #f9f9f9; color: #222; line-height: 1.5; }
    h1 { text-align: center; color: #1a3c6d; margin-bottom: 0.5rem; }
    .subtitle { text-align: center; color: #555; margin-bottom: 1.5rem; }
    .form-group { margin: 1.2rem 0; }
    label { display: block; margin-bottom: 0.4rem; font-weight: 600; }
    input, select { width: 100%; padding: 0.6rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    button { display: block; width: 100%; padding: 0.9rem; font-size: 1.1rem; background: #1a3c6d; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 1.5rem; }
    button:hover { background: #2c5aa3; }
    #result { margin-top: 2rem; padding: 1.5rem; background: white; border: 1px solid #ddd; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; }
    .note { font-size: 0.85rem; color: #555; margin-top: 2rem; text-align: center; }
  </style>
</head>
<body>

  <h1>Wire Gauge Selector</h1>
  <p class="subtitle">Copper/Aluminum • Single-Phase • Ambient Correction • NEC 2023 inspired</p>

  <form id="wireForm">
    <div class="form-group">
      <label>Material</label>
      <select id="material">
        <option value="copper" selected>Copper</option>
        <option value="aluminum">Aluminum</option>
      </select>
    </div>
    <div class="form-group">
      <label>Load Current (A)</label>
      <input type="number" id="current" value="15" step="0.1" min="0" required>
    </div>
    <div class="form-group">
      <label>Voltage (V)</label>
      <input type="number" id="voltage" value="120" step="1" min="1" required>
    </div>
    <div class="form-group">
      <label>One-Way Length (ft)</label>
      <input type="number" id="length" value="100" step="1" min="0" required>
    </div>
    <div class="form-group">
      <label>Temperature Rating</label>
      <select id="tempRating">
        <option value="0">60°C</option>
        <option value="1" selected>75°C</option>
        <option value="2">90°C</option>
      </select>
    </div>
    <div class="form-group">
      <label><input type="checkbox" id="continuous"> Continuous Load (×1.25 ampacity)</label>
    </div>
    <div class="form-group">
      <label>Ambient Temp (°C)</label>
      <input type="number" id="ambient" value="30" step="1" min="-50" max="100">
    </div>
    <div class="form-group">
      <label>Max Voltage Drop (%)</label>
      <input type="number" id="vdMax" value="3" step="0.1" min="0.1" required>
    </div>
    <button type="submit">Calculate</button>
  </form>

  <div id="result"></div>

  <div class="note">
    Approximate NEC 2023 values • Always verify with latest code & local amendments<br>
    Ambient correction from Table 310.15(B)(1) • Voltage drop is recommended, not required
  </div>

  <script>
    const ampacity = {
      copper: {
        14:[15,20,25],12:[20,25,30],10:[30,35,40],8:[40,50,55],
        6:[55,65,75],4:[70,85,95],3:[85,100,110],2:[95,115,130],
        1:[110,130,145],'1/0':[125,150,170],'2/0':[145,175,195],
        '3/0':[165,200,225],'4/0':[195,230,260],
        250:[215,255,290],300:[240,285,320],350:[260,310,350],
        400:[280,335,380],500:[320,380,430],
        600:[350,420,475],700:[385,460,520],
        750:[400,475,535],800:[410,490,555],
        900:[435,520,585],1000:[455,545,615]
      },
      aluminum: {
        12:[15,20,25],10:[25,30,35],8:[35,40,45],
        6:[40,50,55],4:[55,65,75],3:[65,75,85],
        2:[75,90,100],1:[85,100,115],
        '1/0':[100,120,135],'2/0':[115,135,150],
        '3/0':[130,155,175],'4/0':[150,180,205],
        250:[170,205,230],300:[195,230,260],
        350:[210,250,280],400:[225,270,305],
        500:[260,310,350],600:[285,340,385],
        700:[315,375,425],750:[320,385,435],
        800:[330,395,445],900:[355,425,480],
        1000:[375,445,500]
      }
    };

    const resistance = {
      copper: {
        14:2.525,12:1.588,10:0.999,8:0.628,6:0.395,4:0.248,
        3:0.197,2:0.156,1:0.124,'1/0':0.099,'2/0':0.078,
        '3/0':0.062,'4/0':0.049,
        250:0.0515,300:0.0429,350:0.0367,
        400:0.0321,500:0.0258,
        600:0.0214,700:0.0184,750:0.0172,
        800:0.0161,900:0.0143,1000:0.0129
      },
      aluminum: {
        12:2.659,10:1.671,8:1.052,6:0.661,
        4:0.416,3:0.330,2:0.262,1:0.208,
        '1/0':0.165,'2/0':0.131,'3/0':0.104,'4/0':0.082,
        250:0.0847,300:0.0707,350:0.0605,
        400:0.0529,500:0.0424,
        600:0.0353,700:0.0303,750:0.0283,
        800:0.0265,900:0.0235,1000:0.0212
      }
    };

    // Hard-coded order: smallest conductor first (14 AWG → 1000 kcmil)
    const gaugeOrder = [14,12,10,8,6,4,3,2,1,'1/0','2/0','3/0','4/0',250,300,350,400,500,600,700,750,800,900,1000];

    function getGaugeList(material) {
      return gaugeOrder.filter(awg => ampacity[material][awg] !== undefined);
    }

    function findMinGauge(requiredAmp, tempIdx, material) {
      const list = getGaugeList(material);
      const table = ampacity[material];
      for (let awg of list) {
        if (table[awg][tempIdx] >= requiredAmp) {
          return awg;
        }
      }
      return null;
    }

    function calcVD(current, length, awg, voltage, material) {
      const r = resistance[material][awg];
      const vd = 2 * current * length * r / 1000;
      const pct = voltage ? (vd / voltage) * 100 : 0;
      return { vd, pct };
    }

    function formatGauge(awg) {
      if (typeof awg === 'string' && awg.includes('/')) return awg + ' AWG';
      const num = Number(awg);
      if (isNaN(num)) return awg; // fallback
      if (num <= 4 || num >= 250) return num + ' kcmil';
      return num + ' AWG';
    }

    document.getElementById("wireForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const material   = document.getElementById("material").value;
      const current    = parseFloat(document.getElementById("current").value);
      const voltage    = parseFloat(document.getElementById("voltage").value);
      const length     = parseFloat(document.getElementById("length").value);
      const tempIdx    = parseInt(document.getElementById("tempRating").value);
      const continuous = document.getElementById("continuous").checked;
      const vdMax      = parseFloat(document.getElementById("vdMax").value);
      const ambient    = parseFloat(document.getElementById("ambient").value) || 30;

      if (isNaN(current) || isNaN(voltage) || isNaN(length) || isNaN(vdMax)) {
        alert("Please fill in all required fields.");
        return;
      }

      const required = continuous ? current * 1.25 : current;
      let awg = findMinGauge(required, tempIdx, material);

      if (!awg) {
        document.getElementById("result").innerHTML = "<span class='warning'>No suitable gauge found.</span>";
        return;
      }

      let { vd, pct } = calcVD(current, length, awg, voltage, material);

      const list = getGaugeList(material);
      let steps = [];
      let originalAwg = awg;

      while (pct > vdMax) {
        const idx = list.indexOf(awg);
        if (idx === -1 || idx >= list.length - 1) break;
        awg = list[idx + 1];
        ({ vd, pct } = calcVD(current, length, awg, voltage, material));
        steps.push(`  → ${formatGauge(awg)}: ${vd.toFixed(2)} V (${pct.toFixed(2)}%)`);
      }

      let output = `Minimum ampacity required: ${required.toFixed(1)} A ${continuous ? '(×1.25 continuous)' : ''}\n`;
      output += `Smallest sufficient conductor: ${formatGauge(originalAwg)}\n`;
      output += `Actual load current used for voltage drop: ${current.toFixed(1)} A\n`;
      if (length < 5) output += "Note: Very short run — voltage drop is negligible.\n";
      output += `Voltage drop: ${vd.toFixed(2)} V (${pct.toFixed(2)}%)\n`;

      if (steps.length > 0) {
        output += "\nUpsizing due to voltage drop:\n" + steps.join("\n");
      }

      output += `\n\nFinal recommendation: ${formatGauge(awg)}`;

      document.getElementById("result").innerHTML = output;
    });
  </script>
</body>
</html>
